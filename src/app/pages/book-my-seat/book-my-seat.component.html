<div class="dashboard-container">
  <aside class="sidebar">
    <div class="logo">
      <a routerLink="/home"><img src="assets/logo.png" alt="OffiSeat Logo"></a>
    </div>
    <nav class="menu">
      <a routerLink="/dashboard" routerLinkActive="active">Dashboard</a>
      <a routerLink="/reservations" routerLinkActive="active">My Reservations</a>
      <a routerLink="/book-room" routerLinkActive="active">Book a Room</a>
      <a routerLink="/book-seat" routerLinkActive="active">Book my seat</a>
      <a routerLink="/traffic" routerLinkActive="active">Traffic</a>
      <a routerLink="/weather" routerLinkActive="active">Weather</a>
    </nav>
  </aside>

  <main class="content">
    <div class="booking-card">
      <div class="card-header">
        <h2>Book My Seat</h2>
        <p>Choose your floor, room, and time to find an available seat.</p>
      </div>

      <div class="card-body">
        <div class="form-grid">
          <mat-form-field appearance="outline">
            <mat-label>Select Floor</mat-label>
            <mat-select [(ngModel)]="selectedFloorId" (selectionChange)="onFloorChange()">
              <mat-option *ngFor="let floor of floors" [value]="floor.id">
                {{ floor.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Select Room</mat-label>
            <mat-select [(ngModel)]="selectedRoomId" (selectionChange)="onRoomChange()">
              <mat-option *ngFor="let room of rooms" [value]="room.id">
                {{ room.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Date</mat-label>
            <input matInput [matDatepicker]="picker" [(ngModel)]="selectedDate" (dateChange)="onTimeOrDateChange()">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>

           <div class="time-input-group">
            <label>Select Time</label>
            <div class="time-inputs">
              <input type="time" class="time-input" [(ngModel)]="selectedFrom" (change)="onTimeOrDateChange()">
              <span>to</span>
              <input type="time" class="time-input" [(ngModel)]="selectedTo" (change)="onTimeOrDateChange()">
            </div>
          </div>
        </div>

        <h3 class="grid-header">Available Seats</h3>
        <div class="seats-grid" *ngIf="seats.length > 0; else noSeats">
          <div *ngFor="let seat of seats"
               class="seat"
               [class.booked]="!seat.isAvailable"
               [class.selected]="selectedSeats.includes(seat)"
               (click)="toggleSeat(seat)">
            ðŸ’º
            <div class="seat-id">{{ seat.seatNumber }}</div>
          </div>
        </div>
        <ng-template #noSeats>
            <p class="no-seats-message">No seats available for the selected criteria.</p>
        </ng-template>
      </div>

       <div class="card-footer" *ngIf="selectedSeats.length > 0">
        <button class="btn-book" (click)="showConfirm = true">
          Book {{ selectedSeats.length }} Seat(s)
        </button>
      </div>
    </div>
  </main>
</div>

<div class="popup-overlay" *ngIf="showConfirm || showBooked"></div>

<div class="popup" *ngIf="showConfirm">
  <h3>Confirm Booking</h3>
  <p>Are you sure you want to book {{ selectedSeats.length }} seat(s)?</p>
  <div class="popup-buttons">
    <button class="btn-secondary" (click)="closePopup()">Cancel</button>
    <button class="btn-primary" (click)="confirmBooking()">Confirm</button>
  </div>
</div>

<div class="popup success" *ngIf="showBooked">
  <div class="success-icon">âœ“</div>
  <h3>Seats Booked!</h3>
  <p>Your selected seats have been successfully reserved.</p>
  <div class="popup-buttons">
    <button class="btn-primary" (click)="closePopup()">OK</button>
  </div>
</div>